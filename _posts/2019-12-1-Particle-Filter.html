---
layout: comments
---
<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Particle Filter</title></head>
<body>
<h2>引言</h2>
<p>在处理非线性问题上，卡尔曼滤波是通过将非线性模型做一定的变型从而近似为一种线性模型，但是其中会有很大的局限性，因此我们介绍了一种粒子滤波。</p>
<h2>粒子滤波</h2>
<p>粒子滤波是一种基于贝叶斯滤波框架下的基于蒙特卡洛采样的一种滤波方法（马尔科夫过程hmm请bilibili搜徐益达，视频绝对好评），他与卡尔曼的一系列滤波最大的不同大于他是通过采样大量粒子，给粒子赋予权值以此来代替模型的条件概率与后验概率。这种粒子是通过随机采样而得到的。</p>
<p>粒子滤波中的采样方法称之为重要性采样，序贯重要性采样是用蒙特卡洛采样的方法用一个方便得到的一个函数近似于概率密度（由于我的课题中，我的重要性密度采样只需将粒子的权值函数设置为高斯分布即可）。</p>
<p>但是！伴随着这种随机性的产生，必定为出现一种情况，粒子的权值随着迭代的增加将越来越单一化， 并且那些权值极小的粒子将会极大的浪费运算速度。因此在粒子滤波中，都会添加一个重采样步骤。</p>
<h2>重采样</h2>
<p>重采样的思想为“优胜劣汰”。主要的意思就是对权值高的粒子进行复制，而对于权值低的粒子进行淘汰。我们常见的并经常用到的重采样有4种：随机重采样，系统重采样，多项式重采样以及残差重采样，我经常使用随机重采样与系统重采样，这两种重采样方式比较容易理解且便于实现。</p>
<p>但是这也会涉及到粒子匮乏的问题，因为随机重采样的进行，权值大的粒子将会被不断的复制复制，然而抛弃了许多的其他权值较小的粒子，从而使得迭代到最后只剩下一种权值的粒子，这会大大影响粒子滤波的精度问题，为此解决这个问题的方法有：改善重要性采样（仔细思考一下，如果你一开始设的重要性采样非常的好，他的权值分布就越接近于完美的真实分布）和改进重采样（通过不同的方法改进重采样，使得重采样后的粒子群更符合真实分布）。为此我查阅了大量资料，找到了许多改进重采样的方法，并通过粒子群算法（PSO）对我现在研究的课题进行了改善。</p>
<h2>粒子滤波器</h2>
<p>第一步，根据重要性密度函数$q(x^i_{0:k}\mid y_{1:k})$ 选取粒子，粒子的权值可以定义为：</p>
<div>$$
w^i_k\propto \frac{p(x^i_{0:k}\mid y_{1:k})}{q(x^i_{0:k}\mid y_{1:k})}
$$</div>
<p>如果已经得到k-1时刻的后验概率密度$p(x^i_{0:k-1}\mid y_{1:k-1})$ 的近似表示的粒子集合，下一步就是用一个新的粒子集合来近似表示k时刻的后验密度$p(x^i_{0:k}\mid y_{1:k})$ 。为了得到递归的方法，我们将选择的重要性密度函数因式分解：</p>
<div>$$
q(x_{0:k}\mid y_{1:k}=q(x_k\mid x_{0:k-1}q(x_{0:k-1}\mid y_{1:k-1}))
$$</div>
<p>然后，通过获得的新状态$x^i_k\sim q(x_{0:k-1}\mid y_{1:k})$ 加入到已知的粒子集合中，得到新的粒子集合$x^i_{0:k}\sim q(x_{0:k}\mid y_{1:k})$ .根据贝叶斯规则，可以将后验概率密度分解为：</p>
<div>$$
\begin{aligned}
p(x_{0:k}\mid y_{1:k})&amp;=\frac{p(x_{0:k-1}\mid y_{1:k-1})p(x_{0:k}\mid y_{1:k-1})}{p(y_k\mid y_{1:k-1})}\\&amp;=\frac{p(x_{0:k-1}\mid y_{1:k-1})p(x_k\mid x_{0:k-1},y_{1:k-1})p(x_{0:k}\mid y_{1:k-1})}{p(y_k\mid y_{1:k-1})}\\&amp;=p(x_{0:k-1}\mid y_{1:k-1})\frac{p(y_l\mid x_k)p(x_k\mid x_{k-1})}{p(y_k\mid y_{1:k-1})}\\&amp;\propto p(y_k\mid x_k)p(x_k\mid x_{k-1})p(x_{0:k-1}\mid y_{k-1})
\end{aligned}
$$</div>
<p>因此，权值更新方程变为：</p>
<div>$$
\begin{aligned}
w^i_k&amp;\propto \frac{p(y_k\mid x^i_k)p(x^i_k\mid x^i_{k-1})p(x^i_{0:k-1}\mid 
y_{1:k-1})}{q(x^i_k\mid x^i_{0:k-1},y_{1:k})q(x^i_{0:k-1}\mid y_{1:k-1})}\\&amp;=w^i_{k-1}\frac{p(y_k\mid x^i_k)p(x^i_k\mid x^i_{k-1})}{q(x^i_k\mid x^i_{0:k-1},y_{1:k})}
\end{aligned}
$$</div>
<p>因为符合马尔科夫过程，所以可以简化形式。假设$q(x_k\mid x_{0:k-1},y_{1:k})=q(x_k\mid x_{k-1},y_k)$ ,因此重要性密度只和$x_{k-1}$ 和$y_k$ 有关，因此得到最后的权值为：</p>
<div>$$
w^i_k\propto w^i_{k-1}\frac{p(y_k\mid x^i_k)p(x^i_k\mid x^i_{k-1})}{q(x^i_k\mid x^i_{k-1},y_k)}（公式1）
$$</div>
<p>因此估算出后验概率密度的近似为：</p>
<div>$$
p(x_{0:k}\mid y_{1:k})\approx \sum^N_{i=1}w^i_k\delta(x_{0:k}-x^i_{0:k})（公式2）
$$</div>
<h2>粒子滤波流程</h2>
<p>1）从重要性密度函数$q(x_k\mid x_{k-1},y_k)$ 中随机抽取几个样本；</p>
<p>2）逐点计算对应的$p(x_k\mid x_{k-1})$ 和$p(y_k\mid x_k)$ ;</p>
<p>3）利用之前的公式1计算对应样本的重要性权值；</p>
<p>4）对权值进行归一化处理；</p>
<p>5）利用 公式2对后验概率密度进行估计。</p>
<p>SIS粒子滤波的伪代码如下：</p>
<div>$$
\begin{aligned}
(x^i_{0:k},w^i_k)^N_{i=1})=&amp;SIS[(x^i_{0:k-1},w^i_{k-1})^N_{i=1},y_k]
\\&amp;for\ i=1,2,...,N\\&amp;抽样x^i_k\sim q(x_k\mid x^j_{k-1},y_k)\\&amp;按公式1确定粒子的权值w^i_k\\&amp;ENDFOR
\end{aligned}
$$</div>
<p>&nbsp;</p>
</body>
</html>